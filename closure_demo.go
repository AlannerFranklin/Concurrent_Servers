package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {
	// æ¨¡æ‹Ÿè€—æ—¶ï¼Œç¡®ä¿ Goroutine å¯åŠ¨æ—¶ä¸»çº¿ç¨‹å¾ªç¯å·²ç»è·‘å®Œ
	// å®é™…ä¸Šå³ä½¿æ²¡æœ‰è¿™ä¸ª sleepï¼Œä¸»çº¿ç¨‹å¾ªç¯ä¹Ÿé€šå¸¸æ¯”å¯åŠ¨ Goroutine å¿«
	
	// 1. é”™è¯¯å†™æ³•ï¼šé—­åŒ…æ•è·å˜é‡å¼•ç”¨
	fmt.Println("=== âŒ é”™è¯¯å†™æ³• (å¤§å®¶å…±ç”¨åŒä¸€ä¸ª i) ===")
	var wg sync.WaitGroup
	for i := 0; i < 5; i++ {
		wg.Add(1)
		go func() {
			defer wg.Done()
			// è¿™é‡Œçš„ i æ˜¯â€œé—­åŒ…â€æ•è·çš„å¤–éƒ¨å˜é‡ i
			// æ‰€æœ‰çš„ Goroutine éƒ½ç›¯ç€åŒä¸€ä¸ª i
			// å½“å®ƒä»¬å¼€å§‹è·‘çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹æ—©å°±æŠŠ i åŠ åˆ° 5 äº†
			fmt.Printf("%d ", i) 
		}()
	}
	wg.Wait()
	fmt.Println("\n")

	// 2. æ­£ç¡®å†™æ³•ï¼šé€šè¿‡å‚æ•°ä¼ é€’ï¼ˆå€¼æ‹·è´ï¼‰
	fmt.Println("=== âœ… æ­£ç¡®å†™æ³• (æ¯äººæ‹¿åˆ°å½“æ—¶çš„ i) ===")
	for i := 0; i < 5; i++ {
		wg.Add(1)
		// è¿™é‡Œçš„ func(val int) å®šä¹‰äº†ä¸€ä¸ªå‚æ•°
		// åé¢çš„ (i) æŠŠå½“å‰çš„ i çš„å€¼ï¼ˆ0, 1, 2...ï¼‰**æ‹·è´** äº†ä¸€ä»½ä¼ è¿›å»
		go func(val int) {
			defer wg.Done()
			// è¿™é‡Œçš„ val æ˜¯è¿™ä¸ªå‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä¸å†å—å¤–éƒ¨ i å˜åŒ–çš„å½±å“
			fmt.Printf("%d ", val)
		}(i)
	}
	wg.Wait()
	fmt.Println("\n")
	
	// é¢å¤–çš„ï¼šä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ
	// é—­åŒ… = å‡½æ•° + å®ƒå¼•ç”¨çš„å¤–éƒ¨ç¯å¢ƒ
	fmt.Println("=== ğŸ“¦ é—­åŒ…æ¼”ç¤º ===")
	f := createClosure(100)
	fmt.Printf("è°ƒç”¨é—­åŒ…: %d\n", f()) // 101
	fmt.Printf("è°ƒç”¨é—­åŒ…: %d\n", f()) // 102
}

func createClosure(start int) func() int {
	// è¿™ä¸ªåŒ¿åå‡½æ•°å¼•ç”¨äº†å¤–éƒ¨çš„å˜é‡ start
	// å³ä½¿ createClosure å‡½æ•°å·²ç»è¿”å›äº†ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°ä¾ç„¶â€œèƒŒç€â€ start å˜é‡
	// è¿™å°±æ˜¯é—­åŒ…ï¼šå®ƒæŠŠç¯å¢ƒï¼ˆstartï¼‰æ‰“åŒ…å¸¦èµ°äº†
	return func() int {
		start++
		return start
	}
}
