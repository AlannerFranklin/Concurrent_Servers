package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {
	// åœºæ™¯ï¼šæˆ‘ä»¬éœ€è¦å¤„ç† 3 ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡è€—æ—¶ 1 ç§’
	// æ¯”å¦‚ï¼šä¸‹è½½ 3 ä¸ªå¤§æ–‡ä»¶ï¼Œæˆ–è€…å¤„ç† 3 ä¸ªç”¨æˆ·çš„è¯·æ±‚

	fmt.Println("=== ğŸ¢ æ–¹å¼ 1: ä¸å¼€åç¨‹ (é¡ºåºæ‰§è¡Œ) ===")
	start := time.Now()
	for i := 0; i < 3; i++ {
		doWork(i) // ä¸»çº¿ç¨‹äº²è‡ªå¹²æ´»
	}
	fmt.Printf("ğŸ¢ é¡ºåºæ‰§è¡Œæ€»è€—æ—¶: %v\n\n", time.Since(start))

	fmt.Println("=== ğŸš€ æ–¹å¼ 2: å¼€åç¨‹ (å¹¶å‘æ‰§è¡Œ) ===")
	start = time.Now()
	var wg sync.WaitGroup
	for i := 0; i < 3; i++ {
		wg.Add(1)
		// å…³é”®ç‚¹ï¼š
		// 1. ä¸»çº¿ç¨‹åªè´Ÿè´£â€œæ´¾å•â€ï¼Œä¸è´Ÿè´£â€œå¹²æ´»â€ã€‚æ´¾å•é€Ÿåº¦æå¿« (å¾®ç§’çº§)ã€‚
		// 2. é€šè¿‡å‚æ•°ä¼ å‚ (val)ï¼ŒæŠŠä»»åŠ¡ ID ä¹Ÿå°±æ˜¯ i çš„å€¼â€œå¤å°â€ä¸€ä»½ç»™å·¥äººã€‚
		go func(val int) {
			defer wg.Done()
			doWork(val) // å·¥äººæ‹¿ç€å¤å°ä»¶å»å¹²æ´»
		}(i)
	}
	wg.Wait() // ç­‰å¾…æ‰€æœ‰å·¥äººå¹²å®Œ
	fmt.Printf("ğŸš€ å¹¶å‘æ‰§è¡Œæ€»è€—æ—¶: %v\n", time.Since(start))
}

func doWork(id int) {
	fmt.Printf("   [ä»»åŠ¡ %d] å¼€å§‹å·¥ä½œ...\n", id)
	time.Sleep(1 * time.Second) // æ¨¡æ‹Ÿè€—æ—¶ 1 ç§’
	fmt.Printf("   [ä»»åŠ¡ %d] å®Œæˆ!\n", id)
}
